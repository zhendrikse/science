<canvas id="myCanvas" width="600" height="400" style="border: none;"></canvas>
<p style="clear: both;"></p>
Colors: <button id="colorSchemeButton1">scheme 1</button>
<button id="colorSchemeButton2">scheme 2</button>&nbsp;&nbsp;&nbsp;
Canvas: <button id="canvasSizeButton1">small</button>
<button id="canvasSizeButton2">big</button>&nbsp;&nbsp;&nbsp;
Action: <button id="resetButton">reset</button>
<p style="clear: both;"></p>
<label for="mandelbrotToggle"><input type="radio" id="mandelbrotToggle"/>z=0 + i0, c=x + iy</label><br/>
<label for="juliaToggle1"><input type="radio" id="juliaToggle1"/>z=x + iy, c=-0.4 + 0.4i</label><br/>
<label for="juliaToggle2"><input type="radio" id="juliaToggle2"/>z=x + iy, c=-0.4 + 0.6i</label><br/>
<label for="juliaToggle3"><input type="radio" id="juliaToggle3"/>z=x + iy, c=-0.5251993 - 0.5251993i</label><br/>
<label for="juliaToggle4"><input type="radio" id="juliaToggle4"/>z=x + iy, c=0.285 + 0.0001i</label><br/>
<label for="juliaToggle5"><input type="radio" id="juliaToggle5"/>z=x + iy, c=-0.8 + 0.156i</label><br/>
<label for="juliaToggle6"><input type="radio" id="juliaToggle6"/>z=x + iy, c=-0.0 + 0.8i</label><br/>

<script>
    const canvas = document.getElementById("myCanvas");
    const display = canvas.getContext("2d");
    canvas.focus();

    const radioButtons = {
        "mandelbrotToggle": [0, 0],
        "juliaToggle1": [0.4, .4],
        "juliaToggle2": [-0.4, 0.6],
        "juliaToggle3": [-0.5251993, -0.5251993],
        "juliaToggle4": [0.285, 0.001],
        "juliaToggle5": [-0.8, .156],
        "juliaToggle6": [0, 0.8]
    }

    function hsv2rgb(h,s,v) {
        let f= (n, k = (n + h / 60) % 6) => v - v * s * Math.max(Math.min(k, 4 - k , 1), 0);
        return [f(5), f(3), f(1)];
    }

    function hueColor(brightness) {
        return hsv2rgb(brightness * 5 * 360, 1, 1);
    }

    function rgbColor(brightness) {
        return [brightness, Math.sqrt(brightness), brightness ** 0.2];
    }

    class PixelImage {
        constructor(pixelSize=1) {
            const Array2D = (r, c) => [...Array(r)].map(_=>Array(c).fill([0, 0, 0]));
            this.dimX = canvas.width / pixelSize;
            this.dimY = canvas.height / pixelSize;
            this.pixelSize = pixelSize;
            this.colours = Array2D(this.dimX, this.dimY);
        }

        width() {
            return this.dimX;
        }

        height() {
            return this.dimY;
        }

        setColour(pixelX, pixelY, colour) {
            this.colours[pixelX][pixelY] = colour;
        }

        asCanvasImageData() {
            const imageData = display.createImageData(canvas.width, canvas.height);
            for (let x = 0 ; x < canvas.width; x++)
                for (let y = 0 ; y < canvas.height; y++) {
                    let coordinate = y * (canvas.width * 4) + x * 4;
                    const pixelX = Math.trunc(x / this.pixelSize);
                    const pixelY = Math.trunc(y / this.pixelSize);

                    imageData.data[coordinate++] = this.colours[pixelX][pixelY][0] * 255;
                    imageData.data[coordinate++] = this.colours[pixelX][pixelY][1] * 255;
                    imageData.data[coordinate++] = this.colours[pixelX][pixelY][2] * 255;
                    imageData.data[coordinate++] = 255
                }
            return imageData;
        }

        render() {
            display.clearRect(0, 0, canvas.width, canvas.height);
            display.putImageData(this.asCanvasImageData(), 0, 0);
        }
    }

    class FractalRange {
        constructor(re_min, re_max, im_min, im_max) {
            this.re_min = re_min;
            this.re_max = re_max;
            this.im_min = im_min;
            this.im_max = im_max;
        }

        realRange() {
            return this.re_max - this.re_min;
        }

        imaginaryRange() {
            return this.im_max - this.im_min;
        }
    }

    class Fractal {
        // When constantC is zero, this means Mandelbrot set, else Julia set
        constructor(max_iter=500, constantC=0, colorFunction=hueColor) {
            this.juliaRange = new FractalRange(-1.5, 1.5, -1.5, 1.5);
            this.mandelbrotRange = new FractalRange(-2, 1, -1, 1);
            this.constantC = constantC;
            this.maxIter = max_iter;
            this.colorFunction = colorFunction;
            this.range = this.constantC === 0 ? this.mandelbrotRange : this.juliaRange;
            this.image = new PixelImage();
        }

        reset() {
            this.range = this.constantC === 0 ? this.mandelbrotRange : this.juliaRange;
            this.render();
        }

        mapXyToComplexPlane(x, y) {
            const re = this.range.re_min + (x / this.image.width()) * this.range.realRange();
            const im = this.range.im_min + (y / this.image.height()) * this.range.imaginaryRange();
            return this.complex(re, im);
        }

        setPixel(x, y) {
            const c = this.constantC === 0 ? this.mapXyToComplexPlane(x, y) : this.constantC;
            let z = this.constantC === 0 ? this.complex(0, 0) : this.mapXyToComplexPlane(x, y);

            let n = 0;
            while (this.abs_z_squared(z) <= 4 && n < this.maxIter) {
                z = this.z_squared_minus_c(z, c);
                n += 1;
            }

            const brightness = n / this.maxIter;
            if (brightness < 1)
                this.image.setColour(x, y, this.colorFunction(brightness));
        }

        render() {
            this.image = new PixelImage();
            for (let x = 0; x < this.image.width(); x++)
                for (let y = 0; y < this.image.height(); y++)
                    this.setPixel(x, y);
            this.image.render();
        }

        zoomIn(x, y) {
            const c = this.mapXyToComplexPlane(x, y);

            const re_range = .5 * this.range.realRange();
            const im_range = .5 * this.range.imaginaryRange();

            this.range = new FractalRange(c[0] - .5 * re_range, c[0] + .5 * re_range, c[1] - .5 * im_range, c[1] + .5 * im_range);
            this.render();
        }

        setConstantC(newValue) {
            this.constantC = (newValue[0] === 0 && newValue[1] ===0) ? 0 : newValue;
            this.reset();
        }

        setColorFunctionTo(newColorFunction) {
            this.colorFunction = newColorFunction;
            this.render();
        }

        complex(re_, im_) {
            return [re_, im_];
        }

        z_squared_minus_c(z_, c_) {
            return [z_[0] * z_[0] - z_[1] * z_[1] + c_[0], 2 * z_[0] * z_[1] + c_[1]];
        }

        abs_z_squared(z_) {
            return z_[0] * z_[0] + z_[1] * z_[1];
        }
    }

    const fractal = new Fractal();
    fractal.render();
    updateButtons(Object.keys(radioButtons)[0]);

    canvas.addEventListener("click", function(event) {
        const rect = canvas.getBoundingClientRect();
        fractal.zoomIn(event.clientX - rect.left, event.clientY - rect.top);
    });

    document.getElementById("resetButton").addEventListener("click", function(event) {
        fractal.reset();
    });

    document.getElementById("colorSchemeButton1").addEventListener("click", function(event) {
        fractal.setColorFunctionTo(hueColor);
    });

    document.getElementById("colorSchemeButton2").addEventListener("click", function(event) {
        fractal.setColorFunctionTo(rgbColor);
    });

    document.getElementById("canvasSizeButton1").addEventListener("click", function(event) {
        canvas.width = 600;
        canvas.height = 400;
        fractal.render();
    });

    document.getElementById("canvasSizeButton2").addEventListener("click", function(event) {
        canvas.width = 1200;
        canvas.height = 800;
        fractal.render();
    });

    function updateButtons(buttonName) {
        for (let i = 0; i < Object.keys(radioButtons).length; i++)
            document.getElementById(Object.keys(radioButtons)[i]).checked = false;
        document.getElementById(buttonName).checked = true;
    }

    for (let i = 0; i < Object.keys(radioButtons).length; i++) {
        document.getElementById(Object.keys(radioButtons)[i]).addEventListener("click", function(event) {
            fractal.setConstantC(Object.values(radioButtons)[i]);
            updateButtons(Object.keys(radioButtons)[i]);
        });
    }

</script>

