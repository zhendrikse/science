<script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.175.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.175.0/examples/jsm/"
      }
    }
</script>

<canvas id="myCanvas" width="600" height="400" style="border: none;"></canvas><br/>

<script type="module">
    import * as THREE from "three";
    import { OrbitControls } from "three/addons/controls/OrbitControls.js";
    const vector = THREE.Vector3;

    console.clear( );

    const canvas = document.getElementById('myCanvas');
    canvas.focus();
    const canvasWidth = canvas.getAttribute('width');
    const canvasHeight = canvas.getAttribute('height');

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0.075, 0.075, 0.075);

    const camera = new THREE.PerspectiveCamera( 30, canvasWidth/canvasHeight, 1, 100 );
    camera.position.set( 0, 0, 10 );
    camera.lookAt( scene.position );

    const renderer = new THREE.WebGLRenderer( {antialias: true, canvas: canvas} );
    renderer.setSize( canvasWidth, canvasHeight );
    //renderer.setAnimationLoop( animationLoop );

    const controls = new OrbitControls( camera, canvas );
    // controls.enableDamping = true;
    // controls.autoRotate = true;

    const light = new THREE.DirectionalLight( 'white', 1 );
    light.position.set( 25, 25, 25 );
    scene.add( light );



    class Wave {
        constructor(x, y) {
            this._x = x;
            this._y = y;
            this._radius = 0.03;

            const N = x.length * y.length;
            this.positions = new THREE.BufferAttribute(new Float32Array(3 * N), 3);
            this.colors = new THREE.BufferAttribute(new Float32Array(3 * N), 3);
            this.sizes = new THREE.BufferAttribute(new Float32Array(N), 1);

            this.initialize();

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', this.positions);
            geometry.setAttribute('color', this.colors);
            geometry.setAttribute('size', this.sizes);

            this.cloud = new THREE.Points(geometry, starMaterial);
            scene.add(this.cloud);
        }

        initialize() {
            this._surface = [];
            for (let i = 0; i < this._x.length; i++) {
                const droplets_row = [];
                for (let j = 0; j < this._y.length; j++) {
                    const position = new vector(this._x[i], this._y[j], 0)
                    const colour = new THREE.Color(0, 0, .8);
                    droplets_row.push(new Sphere(position, this._radius, colour))
                }
                this._surface.push(droplets_row)
            }
        }


        updateStarSettingsFor(starCounter, position, size) {
            this.positions.setXYZ(starCounter, position.x, position.y, position.z);
            let colour = this.colorAt(position);
            this.colors.setXYZ(starCounter, colour.r, colour.g, colour.b);
            this.sizes.setX(starCounter, size);
        }
    }

    const Lx = 2,
        Ly = 3,
        dx = 0.05,
        dy = 0.05,
        x_range = [],
        y_range = [];

    for (let x = 0; x < Lx + dx; x+=dx)
        x_range.push(x);
    for (let y = 0; y < Ly + dy; x+=dy)
        y_range.push(y);

    const wave = new Wave(x_range, y_range)
    renderer.render(scene, camera);
</script>