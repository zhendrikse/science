<div class="canvasWrapper2D" id="canvas-wrapper" style="aspect-ratio: 3/2;">
    <canvas class="applicationCanvas2D" id="flowerCanvas"></canvas>
</div>

<button class="button" onclick="setColoringSchemeTo(1)">Colors 1</button>&nbsp;
<button class="button" onclick="setColoringSchemeTo(2)">Colors 2</button>&nbsp;
<button class="button" onclick="setColoringSchemeTo(3)">Colors 3</button>&nbsp;
<button class="button" onclick="setColoringSchemeTo(4)">Monochrome</button>
<br/><br>&nbsp;
<input type="checkbox" id="borderAroundDots"/><label for="borderAroundDots">Dots border</label>

<script>
    const canvas = document.getElementById("flowerCanvas");
    const wrapper = document.getElementById('canvas-wrapper');
    const display = canvas.getContext("2d");
    canvas.focus();

    let n = 0;
    const c = 12;
    const numberOfDots = 360;
    let coloringSchemeFunction;

    let drawBorderAroundDots = false;
    document.getElementById("borderAroundDots").checked = drawBorderAroundDots;
    document.getElementById("borderAroundDots").addEventListener("click", function(){
        drawBorderAroundDots = !drawBorderAroundDots;
    });

    function setColoringSchemeTo(number) {
        display.clearRect(0, 0, canvas.width, canvas.height);
        n = 0;
        switch (number) {
            case 1:
                coloringSchemeFunction = (angle, radius, n) => {
                    return hsv2rgb((angle - radius) % 360, 1, 1);
                }
                break;
            case 2:
                coloringSchemeFunction = (angle, radius, n) => {
                    return hsv2rgb(n, 1, 1);
                }
                break;
            case 3:
                coloringSchemeFunction = (angle, radius, n) => {
                    return hsv2rgb(angle % 360, 1, 1);
                }
                break;
            case 4:
                coloringSchemeFunction = (angle, radius, n) => {
                    return hsv2rgb(65, 1, 1);
                }
                break;
        }
    }

    function circle(x, y, radius, fillColor="#DDDD00", outline=false) {
        display.fillStyle = fillColor;
        display.strokeStyle = "#000000";
        display.lineWidth = 1;
        display.beginPath();
        display.arc(x, y, radius, 0, Math.PI * 2, true);
        display.closePath();
        display.fill();
        if (outline)
            display.stroke(); // Gives outline to particle

    }

    function hsv2rgb(h, s, v) {
        let f = (n, k = (n + h / 60) % 6) => v - v * s * Math.max( Math.min(k, 4 - k, 1), 0);
        return [f(5), f(3), f(1)];
    }

    function draw(n) {
        const angle = n * 137.5;
        const radius = c * Math.sqrt(n);

        const x = radius * Math.cos(angle * Math.PI / 180) + centerX;
        const y = radius * Math.sin(angle * Math.PI / 180) + centerY ;

        const colour = coloringSchemeFunction(angle, radius, n);
        const alpha = Math.min(1, 0.3 + n / numberOfDots);
        const rgb = `rgba(${255 * colour[0]}, ${255 * colour[1]}, ${255 * colour[2]},${alpha})`;

        circle(x, y, 8, rgb, drawBorderAroundDots);
    }

    let centerX = 0, centerY = 0;
    function resizeCanvas() {
        const rectangle = wrapper.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;

        canvas.width  = rectangle.width * dpr;
        canvas.height = rectangle.height * dpr;
        centerX = rectangle.width * 0.5;
        centerY = rectangle.height * 0.5;

        canvas.style.width  = rectangle.width + "px";
        canvas.style.height = rectangle.height + "px";

        display.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    resizeCanvas();
    window.addEventListener('resize', () => {
        resizeCanvas();
    });

    setColoringSchemeTo(4)
    window.requestAnimationFrame(function loop() {
        if (n > numberOfDots)
            return; // flower has been drawn

        draw(n++);
        window.requestAnimationFrame(loop);
    });

</script>
