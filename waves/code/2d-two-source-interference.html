<canvas class="applicationCanvas" id="2dInterferenceCanvas"></canvas><br/>
<div style="text-align:center;">
    Separation:
    <input type="range" id="sepSlider" min="0" max="1" step="0.01" value="0.5" oninput="drawImage();">
    &nbsp;&nbsp;&nbsp;
    <input type="button" id="pauseButton" value="Pause" onclick="startStop();">
</div>


<script type="module">
    import { Pixel, PixelImage, Colors } from 'https://www.hendrikse.name/science/js/pixel-image.js';

    const theCanvas = document.getElementById("2dInterferenceCanvas");
    const display = theCanvas.getContext("2d");
    const theWidth = theCanvas.width;
    const theHeight = theCanvas.height;
    const sepSlider = document.getElementById("sepSlider");
    const pauseButton = document.getElementById("pauseButton");

    const image = new PixelImage(display.canvas.width, display.canvas.height, 1, [0, 0, 255]);
    const k = 2 * Math.PI / (theCanvas.width/8);      // angular wavenumber
    const omega = 2 * Math.PI / 15;                   // angular frequency

    let t = 0;                                      // time in arbitrary units
    let running = true;
    function timeStep() {
        t += 1;
        updateImage(t);
        image.render(display);
        if (running) window.setTimeout(timeStep, 1000/40);
    }
    timeStep();

    function updateImage(t) {
        const tPhase = omega * t;
        const sourceOffset = Number(sepSlider.value) * theWidth / 4;
        const xMid = theWidth / 2;
        const yMid = theHeight / 2;
        for (let y = 0; y < theHeight; y++) {               // loop over rows, top to bottom
            for (let x = 0; x < theWidth; x++) {            // loop over pixels in row, left to right
                let dx = x - (xMid - sourceOffset);
                const dy = y - yMid;
                let r = Math.sqrt(dx*dx + dy*dy);       // distance from left source
                const wave1 = Math.sin(k * r - tPhase);     // local amplitude of first wave
                dx = x - (xMid + sourceOffset);
                r = Math.sqrt(dx*dx + dy*dy);           // distance from right source
                const wave2 = Math.sin(k * r - tPhase);     // local amplitude of second wave
                const waveTotal = (wave1 + wave2) / 2;    // value to plot (will be between -1 and 1)
                if (waveTotal > 0)
                    image.setColour(new Pixel(x, y, [0, Math.round(waveTotal * 255), 0]));
                else
                    image.setColour(new Pixel(x, y, [Math.round(-waveTotal * 127), 0, 2 * image.getPixelColourAt(x, y)[2]]));
            }
        }
    }

    function startStop() {
        running = !running;
        if (running) {
            pauseButton.value = "Pause";
            timeStep();
        } else
            pauseButton.value = "Resume";
    }

</script>